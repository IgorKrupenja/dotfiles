#!/bin/bash

# Cannot be run on Linux
case "$OSTYPE" in
linux*)
    echo "ERROR: Script does not support Linux!"
    exit 1
    ;;
esac

# echo in case run from shell
echo "Backup in progress. Please wait..."

################### Backup

cd $DOTFILES

# Brewfile dump
brew bundle dump --force
if [[ $(git diff Brewfile) ]]; then
    git add Brewfile
    git commit -m "Update Brewfile"
fi

# Marta
if [[ $(git diff marta) ]]; then
    git add marta/*
    git commit -m "Update Marta settings"
fi

# commit iTerm plist if there are changes
if [[ $(git diff iterm/com.googlecode.iterm2.plist) ]]; then
    git add iterm/com.googlecode.iterm2.plist
    git commit -m "Update iTerm settings"
fi

# ESLint
if [[ $(git diff eslint) ]]; then
    git add eslint
    git commit -m "Update ESLint settings"
fi

# push
echo ""
echo "Pushing to dotfiles repo:"
echo "-------------------------"
git push

#################### Notifications

# Displaying toast and playing sound
osascript -e 'display notification "Backup complete" with title "cron" sound name "Glass"'

# echo in case run from shell
echo ""
echo "Backup complete."
